import Head from 'next/head';
import Image from 'next/image';
import { useRouter } from 'next/router';
import React, { useEffect, useState } from 'react';
import { io } from 'socket.io-client';
import ChatInput from '../Components/ChatInput';
import LeftNav from '../Components/LeftNav';
import MessageBox from '../Components/MessageBox';
import TopNav from '../Components/TopNav';
import Wellcome from '../Components/Wellcome';



const Home = () => {
    const router = useRouter()
    const [selectedUser,setSelectedUser]= useState<any>(undefined)

    // handle authentication
    useEffect(() => {
        const token = localStorage.getItem('user');
        if (!token) {
            router.push('/login')
        }
    
    })
// message information
const [message,setMessage]= useState([])
const [getmessage,setgetMessage]= useState([])

    // connect socket io frrom chat

    const socket   = io('http://localhost:5000')
    console.log(socket)

const handleSend :React.FormEventHandler<HTMLFormElement> =(e)=>{
e.preventDefault()
const data : any = e.target
  const message:any = data.msg.value
  setMessage(message)
  socket.emit("send-msg",message)



data.reset()

}

// load chat data from server site

useEffect(()=>{

  socket.on('msg-recieve',(data)=>{
    
    setgetMessage(data)
  })

},[getmessage,message,socket])

console.log(getmessage)

    

   
    return (
        <>
            <Head >
                <title>ChatsSkoot - Realtime Chat application</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            {/* main section */}
            <div className="main max-h-screen w-full bg-bgPrimary bg-fixed">
               <LeftNav
                 setSelectedUser={setSelectedUser}
               
               />
{
    !selectedUser ? <Wellcome/>
    :
    <main className="main-content relative  max-h-screen w-full md:pl-[280px] lg:pl-[280px]">
    <div className="z-50 relative">
      <div className='chatContainer h-screen grid '>
  
        <div className="nav text-white">
  
          {/* topNav sectiopn  */}
  
          <TopNav
            
            selectedUser={selectedUser}
          />
  
        </div>
        <div className="chats text-white flex flex-col-reverse px-5 overflow-y-scroll">
  
          <MessageBox
        message={message}
        getmessage={getmessage}
            
          />
  
  
  
        </div>
  
        {/* message options */}
  
        <div className="msgBox grid  content-center items-center gap-6  text-white">
  
  
  
          <Image width={70} height={70} src='/images/attachment.png' alt='attachment' />
  
  
  
<ChatInput
handleSend = {handleSend}

/>
  
        </div>
  
  
  
  
      </div>
    </div>
    <div>
  
    </div>
  </main>
}
            </div>


        </>
    );
};

export default Home;